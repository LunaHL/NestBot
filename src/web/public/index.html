<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>NestBot Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body { font-family: system-ui, sans-serif; margin: 20px; }
    section { border: 1px solid #ddd; padding: 16px; border-radius: 12px; margin-bottom: 16px; }
    h2 { margin: 0 0 12px; }
    input, button, textarea { padding: 8px; margin: 4px 0; width: 100%; max-width: 600px; }
    .row { display: flex; gap: 8px; align-items: center; }
    .row > * { flex: 1; }
    pre { background: #f7f7f8; padding: 8px; overflow: auto; border-radius: 8px; }
    small { color: #666; }
  </style>
</head>
<body>
  <h1>ðŸªº NestBot Dashboard</h1>
  <div class="row">
    <input id="token" placeholder="Bearer token (from .env DASHBOARD_TOKEN)" />
    <input id="gid" placeholder="Guild ID (GUILD_ID)" />
    <button onclick="ping()">Ping</button>
  </div>
  <pre id="log"></pre>

  <section>
    <h2>ðŸ“— Daily Wordle</h2>
    <div class="row">
      <input id="wordle-answer" placeholder="Answer (5 letters)"/>
      <input id="wordle-bonus" type="number" placeholder="Bonus coins (default 5)"/>
      <input id="wordle-date" placeholder="Date YYYY-MM-DD (optional)"/>
    </div>
    <button onclick="setWordle()">Set Wordle</button>
    <button onclick="getWordle()">Get Wordle status</button>
  </section>

  <section>
    <h2>ðŸ›’ Shop Editor</h2>
    <small>Items JSON (array): [{"id":"skip","name":"Skip Spin","price":15,"priceCurrency":"coins","type":"coupon_skip"},{"id":"goodpet","name":"Good Pet Role","price":5,"priceCurrency":"paws","type":"role_cosmetic","meta":{"roleName":"Good Pet"}}]</small>
    <textarea id="shop-json" rows="8" placeholder="Paste items JSON here"></textarea>
    <div class="row">
      <button onclick="saveShop()">Save Shop</button>
      <button onclick="loadShop()">Load Shop</button>
    </div>
  </section>

  <section>
    <h2>ðŸ‘¤ Quick Grant/Deduct</h2>
    <div class="row">
      <input id="uid" placeholder="User ID"/>
      <input id="currency" placeholder="coins|paws|pain"/>
      <input id="amount" type="number" placeholder="+/- amount"/>
    </div>
    <button onclick="grant()">Apply</button>
    <button onclick="getUser()">Get User</button>
  </section>

<script>
function headers() {
  const t = document.getElementById('token').value.trim();
  return t ? { 'Authorization':'Bearer ' + t, 'Content-Type':'application/json' } : { 'Content-Type':'application/json' };
}
function log(...args){ document.getElementById('log').textContent = args.map(a=>typeof a==='string'?a:JSON.stringify(a,null,2)).join('\n'); }
function base(path){ const gid = document.getElementById('gid').value.trim(); return path.replace(':gid', gid); }

async function ping(){
  const res = await fetch('/api/status', { headers: headers() });
  log(await res.json());
}
async function setWordle(){
  const gid = document.getElementById('gid').value.trim();
  const body = {
    answer: document.getElementById('wordle-answer').value.trim(),
    bonus: Number(document.getElementById('wordle-bonus').value || 0) || undefined,
    date: document.getElementById('wordle-date').value.trim() || undefined
  };
  const res = await fetch(`/api/wordle/${gid}`, { method:'POST', headers: headers(), body: JSON.stringify(body) });
  log(await res.json());
}
async function getWordle(){
  const gid = document.getElementById('gid').value.trim();
  const res = await fetch(`/api/wordle/${gid}`, { headers: headers() });
  log(await res.json());
}
async function saveShop(){
  const gid = document.getElementById('gid').value.trim();
  let items = [];
  try { items = JSON.parse(document.getElementById('shop-json').value || '[]'); } catch(e){ return log('Invalid JSON'); }
  const res = await fetch(`/api/shop/${gid}`, { method:'POST', headers: headers(), body: JSON.stringify({ items }) });
  log(await res.json());
}
async function loadShop(){
  const gid = document.getElementById('gid').value.trim();
  const res = await fetch(`/api/shop/${gid}`, { headers: headers() });
  const json = await res.json();
  document.getElementById('shop-json').value = JSON.stringify(json.items || [], null, 2);
  log(json);
}
async function grant(){
  const gid = document.getElementById('gid').value.trim();
  const body = {
    uid: document.getElementById('uid').value.trim(),
    currency: document.getElementById('currency').value.trim(),
    amount: Number(document.getElementById('amount').value || 0)
  };
  const res = await fetch(`/api/grant/${gid}`, { method:'POST', headers: headers(), body: JSON.stringify(body) });
  log(await res.json());
}
async function getUser(){
  const gid = document.getElementById('gid').value.trim();
  const uid = document.getElementById('uid').value.trim();
  const res = await fetch(`/api/user/${gid}/${uid}`, { headers: headers() });
  log(await res.json());
}
</script>
</body>
</html>
